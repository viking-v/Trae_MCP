# 上线准备计划（详细版）

适用范围：当前项目从“可用版本”走向“生产上线”的全流程准备、实施与运维保障。

## 角色与负责人（建议岗位）
- 产品负责人（PO）：范围冻结、验收口径、上线决策、业务对齐
- 研发负责人（Tech Lead）：技术方案、发布审批、风险兜底
- 后端负责人（BE Owner）：API/DB/任务调度、数据迁移与回滚、性能
- 前端负责人（FE Owner）：页面、埋点、灰度开关、兼容性与回退
- 测试负责人（QA Owner）：测试计划、UAT组织、缺陷分级、质量门禁
- 运维负责人（SRE/DevOps Owner）：资源申请、部署、监控报警、应急响应
- 安全负责人（Security Owner）：安全评审、漏洞扫描、合规检查
- 客服/运营负责人（Ops Owner）：公告、用户沟通、反馈闭环、工单处理

如团队规模较小，可合并角色，但每项任务必须有唯一责任人（Owner）。

## 时间轴（推荐模板）
以“上线日”为 D0，倒排关键节点：
- D-14 ～ D-10：项目收尾与冻结准备（冻结条件达成）
- D-9 ～ D-5：上线前准备（资源/文档/演练/监控就绪）
- D-4 ～ D0：上线实施（灰度→全量、数据迁移、应急待命）
- D+1 ～ D+14：上线后维护（值班、优化、迭代机制）

实际日期由 PO 与 SRE 在发布窗口评审会确定后填写到本计划。

## 质量门禁（统一标准）
- 缺陷门禁：P0/P1=0；P2 有明确规避/降级/回滚预案；P3 进入迭代池
- 发布门禁：CI 全绿；核心链路回归用例 100% 通过；安全基线通过
- 数据门禁：迁移/回滚演练通过；关键表校验脚本与对账口径确认
- 监控门禁：核心指标、日志、报警、值班通信链路全部可用

## 阶段一：项目收尾阶段（D-14 ～ D-10）

### 目标
完成核心功能开发、完成冻结条件、为系统级测试与 UAT 提供稳定版本。

### 任务清单（含负责人/交付物/时间/验收/风险）

| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 核心功能开发收尾，范围确认 | PO（A）/Tech Lead（R） | D-14 | 《上线范围清单》冻结版本号/commit | 范围变更需走变更评审；不再新增需求 | 范围蔓延→设置变更阈值与审批；非关键需求延期 |
| 代码冻结（功能冻结/接口冻结） | Tech Lead（A） | D-12 | 冻结公告；冻结分支策略 | 冻结后仅允许修复缺陷；合并需审批 | 临时需求插入→走紧急变更流程并评估风险 |
| 系统集成测试（SIT）计划与执行 | QA Owner（R） | D-12 ～ D-10 | 《SIT测试报告》含通过率/缺陷列表 | 核心链路用例 100% 执行；阻断缺陷为0 | 环境不稳定→提前锁定环境与数据；并行准备备份环境 |
| UAT 计划与业务验收组织 | PO（R）/QA（C） | D-11 ～ D-10 | 《UAT验收记录》/签字或邮件确认 | UAT用例通过；验收口径一致 | 验收口径不一致→验收前对齐“验收标准”与示例数据 |
| P0/P1 缺陷清零与复测 | QA（A）/BE&FE（R） | D-10 | 缺陷关闭列表 | P0/P1=0，复测通过率100% | 反复回归→建立变更影响面清单、回归优先级策略 |
| 安全与合规基线评审（首次） | Security（R） | D-10 | 《安全评审结论》 | 高危/严重=0；中危有修复计划 | 发现高危→阻断发布，启动快速修复与复扫 |

### 阶段输出物（必须）
- 《上线范围清单（冻结版）》
- 《SIT 测试报告》《UAT 验收记录》
- 《P0/P1 缺陷清零证明》
- 《安全评审结论（第一次）》

## 阶段二：上线前准备（D-9 ～ D-5）

### 目标
确保“可部署、可观测、可回滚、可运维”，完成演练与上线资料。

### 2.1 上线 checklist 与回滚方案
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 上线 Checklist 编制 | Tech Lead（R）/SRE（A） | D-9 | 《上线Checklist》可勾选、可追踪 | 覆盖：配置/证书/DB/缓存/队列/监控/回滚/验证 | 漏项→演练中补齐并版本化管理 |
| 回滚策略与触发阈值定义 | Tech Lead（A）/SRE（R） | D-9 | 《回滚方案》含回滚步骤与阈值 | 10分钟内可执行回滚；阈值可量化 | 回滚过慢→预置旧版本镜像与数据回滚脚本 |
| 灰度/开关策略与降级方案 | FE Owner（R）/BE Owner（C） | D-8 | 《灰度与开关清单》 | 开关默认安全；禁用不影响基本可用 | 开关失效→配置中心/环境变量双通道 |

### 2.2 生产部署文档与运维手册
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 生产部署文档 | SRE（R）/BE（C） | D-8 | 《部署文档》含步骤/依赖/回滚 | 新人可按文档独立完成部署演练 | 文档与实际不符→演练后必须回写更新 |
| 运维手册与SOP | SRE（A） | D-7 | 《运维手册》含常见故障处理 | 常见故障可在15分钟内定位与缓解 | 响应慢→建立排障脚本与告警分级 |
| 安全基线检查（第二次） | Security（R） | D-7 | 《上线前安全检查表》 | 账号/权限/端口/密钥合规 | 密钥泄露→轮换密钥与审计访问记录 |

### 2.3 资源申请与基础设施配置
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 服务器/数据库/对象存储申请 | SRE（R） | D-9 ～ D-7 | 资源清单与规格确认 | 性能压测满足目标；容量冗余≥30% | 资源不足→预留扩容通道与阈值触发 |
| 网络与安全组/域名/证书 | SRE（A）/Security（C） | D-7 | DNS/证书/安全组配置记录 | HTTPS可用；仅开放必要端口 | 配置错误→变更审计与双人复核 |
| 配置管理与密钥管理 | SRE（R）/Tech Lead（A） | D-7 | 配置项列表、密钥托管方式 | 配置可追踪；密钥不落库不入仓 | 配置漂移→采用环境化配置与变更审批 |

### 2.4 监控报警与日志收集
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 指标监控（可用性/延迟/错误率） | SRE（R） | D-6 | Dashboard + 告警规则 | 告警能触达；误报率可控 | 告警风暴→分级、抑制、聚合策略 |
| 日志收集（应用/访问/审计） | SRE（R）/BE（C） | D-6 | 日志规范、检索与留存策略 | 可按 request-id/用户id追踪 | 日志缺字段→上线前补齐关键字段 |
| 链路追踪（可选） | SRE（C）/BE（R） | D-5 | Trace 采样策略 | 核心链路可定位瓶颈 | 成本过高→采样与按需开启 |

### 2.5 MCP（任务控制平台）工具引入与集成
目标：在上线前形成“任务自动化分配/跟踪 + 可视化进度监控 + 与代码/CI/告警联动”的统一工作台。

说明：若 D0 距离当前不足 6 周，则按“最晚节点”压缩执行（但不降低验收标准）。

| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 市场调研与候选清单（3-4个） | Tech Lead（R）/QA（C） | D-42 ～ D-35 | 《候选清单+差异点》 | 满足硬性要求（任务/协作/API） | 候选过多→按权重与硬性门槛初筛 |
| 评估标准与打分矩阵定稿 | Tech Lead（A）/PO（R） | D-35 | 《评估矩阵》含权重 | 权重与验收口径统一 | 指标不落地→用“可度量指标”反推 |
| 演示与试用（7天试点） | QA（A）/全员参与 | D-35 ～ D-28 | 试点项目看板、演示记录 | 真实跑通端到端流程 | 团队参与不足→试点任务纳入当周工作 |
| 选型决策（采购/自研/混合） | PO（A）/Tech Lead（R） | D-28 | 《评估报告+选型结论》 | 主方案+备选方案明确 | 争议大→以“上线风险最小”优先 |
| 平台部署/租户开通与权限模型 | SRE（R）/Security（A） | D-28 ～ D-21 | 租户/项目空间/权限RBAC | 最小权限；审计可追溯 | 权限过宽→双人复核与审计抽查 |
| 流程模板化（字段/状态/看板/里程碑） | Tech Lead（A）/QA（R） | D-21 ～ D-14 | 项目模板、状态机、报表模板 | 新项目10分钟可启用 | 过度复杂→先MVP字段，迭代优化 |
| 系统集成开发与联调（API/Webhook/自动化） | BE Owner（R）/SRE（A） | D-14 ～ D-7 | 《集成清单+联调记录》 | 代码/CI/IM/告警至少三类联动 | 集成不稳→先单向通知，后双向回写 |
| 团队培训与试运行 | PO（A）/QA（R） | D-7 ～ D-3 | 课件、SOP、FAQ、试运行周报 | 成员独立完成任务流转 | 学习成本高→录屏与“操作卡片” |
| 上线前 MCP 集成测试（模拟上线演练） | QA（A）/SRE（R） | D-3 ～ D-1 | 演练记录与问题清单 | 端到端“模拟上线”可追溯 | 演练失败→阻断上线并修复重测 |

### 阶段输出物（必须）
- 《上线Checklist》《回滚方案》《灰度与开关清单》
- 《生产部署文档》《运维手册（SOP）》
- 《资源与基础设施配置清单》
- 《监控报警与日志方案》
- 《MCP 评估报告》《MCP 集成与演练记录》

## 阶段三：上线实施（D-4 ～ D0）

### 目标
按灰度/金丝雀发布逐步放量，完成数据迁移与初始化，确保随时可回滚。

### 3.1 分阶段部署（灰度/金丝雀）
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 发布前会议（Go/No-Go） | PO（A）/Tech Lead（R） | D-1 | 会议记录+结论 | 门禁项全部达标 | 临时风险→延后窗口或降级上线 |
| 金丝雀发布 1%（或指定用户） | SRE（R） | D0 | 发布记录、版本号、开关状态 | 关键指标无劣化；错误率在阈值内 | 异常→立即回滚/关闭开关，止损优先 |
| 灰度放量 10%→50%→100% | SRE（A）/Tech Lead（C） | D0 | 放量节奏与每阶段验证记录 | 每阶段验证通过才进入下一阶段 | 指标抖动→延长观察窗口/暂停放量 |

### 3.2 数据迁移与初始化（按需）
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 迁移方案设计与演练 | BE Owner（R）/SRE（C） | D-3 | 《迁移方案》+演练报告 | 可重复执行；可回滚 | 数据不一致→校验脚本、对账口径 |
| 生产数据备份与快照 | SRE（A） | D0-1h | 备份记录、恢复演练记录 | 恢复可行；RPO/RTO 满足要求 | 备份失败→阻断上线 |
| 数据初始化（种子/配置/权限） | BE Owner（R） | D0 | 初始化清单与结果 | 核心账号/权限正确；配置一致 | 初始化遗漏→按清单对齐并二次校验 |

### 3.3 应急预案与快速响应
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 应急预案（故障分级/响应SLA） | SRE（A）/Tech Lead（R） | D-2 | 《应急预案》与通讯录 | P0 5分钟响应，15分钟定位方向 | 联系链路断→双通道（IM+电话） |
| 回滚演练（全流程） | SRE（R）/BE（C） | D-2 | 回滚演练记录 | 10分钟内完成回滚+验证通过 | 演练失败→必须修正后再上线 |
| 发布窗口值守排班 | SRE（R）/Ops（C） | D-1 | 值班表 | 覆盖发布前后至少 6-12 小时 | 人员缺口→提前协调替补 |

### 阶段输出物（必须）
- 《Go/No-Go 结论与会议记录》
- 《灰度发布记录（每阶段指标与验证）》
- 《迁移方案与演练报告》《生产备份记录》
- 《应急预案》《回滚演练记录》《发布值班表》

## 阶段四：上线后维护（D+1 ～ D+14）

### 目标
稳定运行、快速响应、持续优化，建立反馈闭环与迭代机制。

### 4.1 24小时值班与稳定性治理
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 24小时技术值班（首周） | SRE（A）/Tech Lead（R） | D+1 ～ D+7 | 值班表、交接记录 | 告警响应 SLA 达标 | 疲劳值守→轮班与升级机制 |
| 线上问题复盘与行动项 | Tech Lead（A） | 每次故障后24h | 复盘报告+行动项 | 行动项按期关闭 | 行动项堆积→每周追踪与负责人考核 |

### 4.2 性能优化与容量扩展
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 性能基线与容量模型 | BE Owner（R）/SRE（A） | D+3 | QPS/延迟/资源曲线 | 高峰期延迟不超阈值 | 流量突增→扩容预案与自动伸缩 |
| 压测与扩容演练 | SRE（R） | D+7 | 压测报告与扩容演练 | 扩容可在目标时间内完成 | 扩容失败→预留冗余与手工扩容方案 |

### 4.3 用户反馈与迭代机制
| 任务 | 负责人 | 时间节点 | 交付物标准 | 质量验收标准 | 风险与应对 |
|---|---|---:|---|---|---|
| 反馈渠道与工单机制 | Ops Owner（R）/PO（A） | D+1 | 反馈入口/工单分类/优先级规则 | 反馈可追踪、可闭环 | 信息噪声→分类与模板化采集 |
| 版本节奏与迭代看板 | PO（R）/Tech Lead（C） | D+3 | 迭代节奏说明、看板 | 每周评审、每两周发布（可调整） | 迭代失控→冻结窗口与发布列车机制 |

### 阶段输出物（必须）
- 《值班表与交接记录》《线上问题复盘》
- 《性能基线/压测报告/容量扩展预案》
- 《反馈与迭代机制说明》《工单与看板》

## 附录A：上线 Checklist（最小必备条目）
### 变更与版本
- 版本号/commit/tag 已确定，变更清单可追溯
- 依赖升级与破坏性变更已评审
- 配置项差异（dev/staging/prod）已核对

### 数据与存储
- 迁移脚本可重复执行；回滚脚本已准备
- 生产备份完成并验证可恢复
- 文件存储（上传凭证）目录权限与访问路径验证通过

### 安全
- 密钥不入仓，轮换策略明确
- 管理端鉴权与权限隔离验证通过
- 关键操作审计可查询

### 可观测
- 指标面板可用：请求量、错误率、延迟、资源
- 告警策略可触达：分级、抑制、升级
- 日志检索可按用户/请求追踪

## 附录B：回滚方案（模板）
- 回滚触发阈值（示例）：错误率>1%持续10分钟 / 关键链路不可用 / 数据异常扩大
- 回滚步骤：停止放量→关闭开关→回滚应用版本→必要时回滚数据→验证→复盘
- 回滚验证：登录、提交激活、审核通过、分润查询、团队查询
